#define _GNU_SOURCE
#include <unistd.h>
#include <string.h>
#include <sys/mman.h>

unsigned char code[] = { 0x48, 0x8d, 0x3d, 0x53, 0x00, 0x00, 0x00, 0x48, 0x31, 0xc9, 0x8a, 0x04, 0x0f, 0x88, 0xcb, 0xfe, 0xc3, 0x30, 0xd8, 0x88, 0x04, 0x0f, 0xfe, 0xc1, 0x80, 0xf9, 0x1a, 0x7e, 0xed, 0x48, 0x31, 0xc0, 0xb0, 0x02, 0x48, 0x89, 0xc6, 0x48, 0xc7, 0xc7, 0x6c, 0x00, 0x00, 0x00, 0x57, 0x48, 0xbf, 0x2f, 0x64, 0x65, 0x76, 0x2f, 0x6e, 0x75, 0x6c, 0x57, 0x48, 0x89, 0xe7, 0x0f, 0x05, 0x48, 0x89, 0xc7, 0x48, 0x31, 0xc0, 0xfe, 0xc0, 0x48, 0x8d, 0x35, 0x0e, 0x00, 0x00, 0x00, 0x48, 0xc7, 0xc2, 0x1a, 0x00, 0x00, 0x00, 0x0f, 0x05, 0x48, 0x83, 0xc4, 0x10, 0xc3, 0x47, 0x4e, 0x42, 0x43, 0x28, 0x62, 0x36, 0x6c, 0x7a, 0x3a, 0x66, 0x3f, 0x62, 0x60, 0x3c, 0x63, 0x25, 0x6b, 0x63, 0x60, 0x67, 0x22, 0x74, 0x7d, 0x26, 0x25 };

int main() {
    mprotect((void *)((unsigned long)code & ~0xfff), 0x1000, PROT_READ | PROT_WRITE | PROT_EXEC);
    write(STDOUT_FILENO, "Hello! I'm about to write the flag... to /dev/null :)\n", 54);
    ((void (*)())code)();
    write(STDOUT_FILENO, "Flag written to /dev/null, good bye!\n", 37);

    return 0;
}